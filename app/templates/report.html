<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>PfSense Compliance Report - {{ device.name }}</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 30px; }
        h1 { margin-bottom: 5px; }
        h2 { margin-top: 0; }
        h3 { margin-top: 25px; }
        .meta { font-size: 12px; color: #555; margin-bottom: 20px; }
        .cards { display: flex; flex-wrap: wrap; gap: 12px; margin-bottom: 25px; }
        .card {
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 8px 12px;
            min-width: 140px;
        }
        .card-title { font-size: 11px; text-transform: uppercase; color: #555; }
        .card-value { font-size: 20px; font-weight: bold; }
        table { border-collapse: collapse; width: 100%; margin-top: 10px; }
        th, td { border: 1px solid #ccc; padding: 6px; font-size: 12px; vertical-align: top; }
        th { background: #eee; }
        .btn-print {
            display: inline-block;
            padding: 6px 12px;
            margin-bottom: 20px;
            border: 1px solid #333;
            border-radius: 4px;
            background: #f5f5f5;
            cursor: pointer;
            font-size: 13px;
        }
        .btn-print:hover {
            background: #e0e0e0;
        }

        /* Hide buttons / links when printing */
        @media print {
            .no-print { display: none !important; }
            body { margin: 10mm; }
        }
    </style>
</head>
<body>
    <div class="no-print">
        <button class="btn-print" onclick="window.print()">Print / Save as PDF</button>
        &nbsp;
        <a href="{{ url_for('device_checklist', device_id=device.id) }}">Back to Checklist</a>
    </div>

    <h1>PfSense Compliance Report</h1>
    <h2>Device: {{ device.name }}{% if device.hostname %} ({{ device.hostname }}){% endif %}</h2>

    <div class="meta">
        Generated on: {{ generated_on }}<br>
        Notes: {{ device.notes or "N/A" }}
    </div>

    <div class="cards">
        <div class="card">
            <div class="card-title">Total Controls</div>
            <div class="card-value">{{ summary.total_items }}</div>
        </div>
        <div class="card">
            <div class="card-title">Reviewed</div>
            <div class="card-value">{{ summary.reviewed }}</div>
        </div>
        <div class="card">
            <div class="card-title">Not Reviewed</div>
            <div class="card-value">{{ summary.not_reviewed }}</div>
        </div>
        <div class="card">
            <div class="card-title">Compliant</div>
            <div class="card-value">{{ summary.compliant }}</div>
        </div>
        <div class="card">
            <div class="card-title">Non Compliant</div>
            <div class="card-value">{{ summary.non_compliant }}</div>
        </div>
        <div class="card">
            <div class="card-title">Non Applicable</div>
            <div class="card-value">{{ summary.non_applicable }}</div>
        </div>
        <div class="card">
            <div class="card-title">Compliance (Reviewed)</div>
            <div class="card-value">{{ summary.compliance_pct }}%</div>
        </div>
    </div>

    <h3>Non-Compliant Controls</h3>
    {% if non_compliant %}
    <table>
        <tr>
            <th>Control ID</th>
            <th>Section</th>
            <th>Title</th>
            <th>Reviewer Comment</th>
        </tr>
        {% for item in non_compliant %}
        <tr>
            <td>{{ item.control_id }}</td>
            <td>{{ item.section }}</td>
            <td>{{ item.title }}</td>
            <td>{{ item.comment or "" }}</td>
        </tr>
        {% endfor %}
    </table>
    {% else %}
    <p>No controls are currently marked as <strong>Non Compliant</strong>.</p>
    {% endif %}

    <h3>Not Reviewed Controls</h3>
    {% if not_reviewed %}
    <table>
        <tr>
            <th>Control ID</th>
            <th>Section</th>
            <th>Title</th>
        </tr>
        {% for item in not_reviewed %}
        <tr>
            <td>{{ item.control_id }}</td>
            <td>{{ item.section }}</td>
            <td>{{ item.title }}</td>
        </tr>
        {% endfor %}
    </table>
    {% else %}
    <p>All controls have been reviewed.</p>
    {% endif %}
</body>
</html>
